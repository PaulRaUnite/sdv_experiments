# Experiments with timing information for HAL and SDV
In this repository we collect experiments involving Hardware Abstraction Layer and software component timing constraints.
Currently, we perform the following timing analysis: order and probability of misses using CADP probabilistic query and reaction time extraction from traces [MRTCCSL/bin/reactions](./mrtccsl/bin/).
Both use simulation data, generated by either MRTCCSL or [Simpy](./simulation/).

The [probabilistic-model-analysis](./probabilistic-model-analysis/) directory contains the experiment results using the IF toolset for generating LTSs and the CADP toolbox to do probabilistic querying.

The simulation directory contains an alternative way to generate execution traces using Simpy.
To run the simulator, execute the python code with the following command:
```
python simulator.py
```

## MRTCCSL
### Installation
Firstly, the user should install [opam](https://opam.ocaml.org/) distribution for their system.
We can only guarantee that the project compile work under Linux (tested on Ubuntu 25.04), and due to `opam` having hard time working under Windows at the time of writing, we would recommend using at least WSL.

To install the library with the simulation and reaction time computation executables, please follow these commands:
```bash
opam switch create ./ ocaml-variants.5.3.0+options ocaml-option-flambda
eval $(opam env)
opam pin git+https://github.com/PaulRaUnite/mrtccsl#70b300ed934a98a11169fb0634818925b81ccca3
opam install mrtccsl
```
During the installation, `opam` should prompt the user to install missing system libraries through their package manager (it is at least the case with [GMP](https://gmplib.org/) library).
`flambda` (`ocaml-variants...` line) is optional but encouraged if possible, as it provides better optimization.

This process will install the executable `reaction` that computes reactions times from Python script traces:
```
reaction <input> -o <output> -c <chain>
-o output file
-c chain spec
-help  Display this list of options
--help  Display this list of options
```
Functional chain specification is provided as a string `<act>((->|?)<act>)^*`, where `->` means causality and `?` means sampling. In our case, we use specification `s.s->s.f->c.s->c.f?a.s->a.f`.

2 other executables are compiled from files in directory `simulation/mrtccsl`: they contain the description of the system and its parameters, and generate the traces and reaction times, and can be used as follows:
```
full [-t <traces>] [-n <cores>] [-h <trace horizon>] [-bob] [-cadp] <dir>
-t Number of traces to generate
-c Number of cores to use
-h Max time of simulation
-s Max steps of simulation
-bob Print svgbob trace
-cadp Print CADP trace
-help  Display this list of options
--help  Display this list of options
```

### Visualization
The reaction time plots are generated using [gnuplot](https://www.gnuplot.info/) version 6 (version 5 or lower may work but it was not tested).

### Usage
Then the process is as follows:
- update terminal environment with `eval $(opam env)`;
- generate traces and reaction time distributions:
    - either by using MRTCCSL and `simple`/`full` executables:
    ```bash 
    dune exec simple --release -- -c 4 -t 10 -s 100000 -h 100000 -bob -cadp ./data_mrtccsl/full/
    ./visualize-reaction.sh ./data_mrtccsl/
    ```
    Replace simple with full to simulate the 7 component AEBS.
    - or by using the python script
    ```bash
    python ./simulation/simulator.py
    ./compile-reaction.sh ./data/
    ./visualize-reaction.sh ./data/
    ```
    - the resulting plots in PDF, trace vizualization (only MRTCCSL) and reaction times are then can be found next in the data directories.

After this, `*.cadp.txt` traces can be used as input for the analysis described in [./probabilistic-model-analysis/README.md](./probabilistic-model-analysis/README.md).
